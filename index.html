<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motion Sensor Capture</title>
</head>
<body>
    <h1>Device Motion and GPS Data</h1>
    <button id="requestPermission">Enable Sensors</button>
    <button id="pauseTracking">Pause Sensors</button>
    <label for="interval">Telemetry Interval (ms):</label>
    <input type="number" id="interval" value="1000" min="100">
    <p>Accelerometer: <span id="accel"></span></p>
    <p>Gyroscope: <span id="gyro"></span></p>
    <p>GPS: <span id="gps"></span></p>

    <script>
        let telemetryInterval = 1000;
        let trackingActive = false;
        let motionInterval, orientationInterval, gpsInterval;

        document.getElementById('requestPermission').addEventListener('click', () => {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(permissionState => {
                    if (permissionState === 'granted') {
                        startTracking();
                    } else {
                        alert('Motion permission denied');
                    }
                }).catch(console.error);
            } else {
                startTracking();
            }
        });

        document.getElementById('interval').addEventListener('change', (event) => {
            telemetryInterval = parseInt(event.target.value) || 1000;
            if (trackingActive) {
                stopTracking();
                startTracking();
            }
        });

        document.getElementById('pauseTracking').addEventListener('click', () => {
            if (trackingActive) {
                stopTracking();
                document.getElementById('pauseTracking').textContent = 'Resume Sensors';
            } else {
                startTracking();
                document.getElementById('pauseTracking').textContent = 'Pause Sensors';
            }
        });

        function startTracking() {
            trackingActive = true;

            if (window.DeviceMotionEvent) {
                motionInterval = setInterval(() => {
                    window.addEventListener('devicemotion', (event) => {
                        let accel = event.accelerationIncludingGravity;
                        document.getElementById('accel').textContent =
                            `X: ${accel.x.toFixed(2)}, Y: ${accel.y.toFixed(2)}, Z: ${accel.z.toFixed(2)}`;
                    }, { once: true });
                }, telemetryInterval);
            }

            if (window.DeviceOrientationEvent) {
                orientationInterval = setInterval(() => {
                    window.addEventListener('deviceorientation', (event) => {
                        document.getElementById('gyro').textContent =
                            `Alpha: ${event.alpha.toFixed(2)}, Beta: ${event.beta.toFixed(2)}, Gamma: ${event.gamma.toFixed(2)}`;
                    }, { once: true });
                }, telemetryInterval);
            }

            if (navigator.geolocation) {
                gpsInterval = setInterval(() => {
                    navigator.geolocation.getCurrentPosition((position) => {
                        document.getElementById('gps').textContent =
                            `Lat: ${position.coords.latitude.toFixed(6)}, Lon: ${position.coords.longitude.toFixed(6)}`;
                    }, (error) => {
                        document.getElementById('gps').textContent = `GPS Error: ${error.message}`;
                    });
                }, telemetryInterval);
            }
        }

        function stopTracking() {
            trackingActive = false;
            clearInterval(motionInterval);
            clearInterval(orientationInterval);
            clearInterval(gpsInterval);
        }
    </script>
</body>
</html>
